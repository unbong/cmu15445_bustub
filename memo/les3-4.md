# 数据库存储
## 数据库管理软件如何玩表达在磁盘上的数据库
* 文件存储
    * 存储管理器负责数据库文件的维护
        * 组织文件作为页的集合
            * 追踪数据的读写到页
            * 追逐可用的空间
    * 页是固定大小的数据块
        * 可以保存元组，元数据，索引等
    * 每个页具有唯一的标识符
    * 数据库的页大小在512B到16kb不等
    * 页存储架构
        * 堆文件组织
            * 堆文件是一个未排序的由随机顺序存储的元组的页集合
            * 页文件夹
                * 数据库管理软件维护追踪数据页位置的特殊的页
                * 文件夹还需要记录可用空间的元数据
        * 树文件组织
        * 序列文件组织
        * 散列文件组织
    
* 页的布局
    * 每一个页包含关于页内容的元数据头
        * 页大小，CheckSum， 数据库版本，事物可见性，压缩信息等。

    * 页的布局方式
        * 面向元组的
            * 按槽位的页的布局
                * 在页的头部后面维护一些槽位的数组，该槽位映射元组的开始位置的信息。
                * 槽位数组从左至右的增长，相反元组是从右至左增长，当空间不够时停止写入数据
                * 当元组被删除时其被删除的位置会被其他元组填上
            * 页的头持续追踪槽的使用情况
            * 页的头持续追踪最后的一个槽的开始位置的offset
            
            * 元组（记录）id    
                * 每个元组被分配唯一的记录识别符
                    * 最普遍：页的id+offset/slot

            * 插入数据的流程
                * 检查页文件夹，去找到空闲的槽
                * 从磁盘取得页
                * 检查槽的数组去找到空闲空间并写入
            
            * 更新原有的元组
                * 检查页文件夹而定位页的位置
                * 从磁盘取得页
                * 在槽数组中查找使用槽的offset
                * 重写原有的数据

        * 日志结构的
            * 在日志中保存执行的处理（插入与闪促） ，并在始终保存元组的id
            * 当被查询时返回最新版本的元组数据
            * 每当页的大小接近一个阈值时，会将日志进行合并，合并的过程为之保留最新版本的元组日志

* 元组布局
    * 每个元组都有预置的保存了元组的元数据的头
        * 可见性信息
        * NULL值的位图
    * 元组的长度有固定和可变长两种